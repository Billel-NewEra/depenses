{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center">
  <h3>DÃ©tail Avance {{ avance.code }}</h3>
  <div>
    <a href="{{ url_for('edit_avance', avance_id=avance.id) }}" class="btn btn-warning btn-sm">âœï¸ Modifier</a>
    <form method="POST" action="{{ url_for('delete_avance', avance_id=avance.id) }}" class="d-inline"
          onsubmit="return confirm('Supprimer cette avance et ses mouvements ?')">
      <button class="btn btn-danger btn-sm">ğŸ—‘ï¸ Supprimer</button>
    </form>
  </div>
</div>
<p class="text-muted mb-1"><strong>Titre :</strong> {{ avance.titre }}</p>
<p class="text-muted"><strong>Description :</strong> {{ avance.description }}</p>
<div class="row g-3">
  <div class="col-md-6">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h5>Versements</h5>
      <a class="btn btn-sm btn-success" href="{{ url_for('add_versement', avance_id=avance.id) }}">+ Ajouter</a>
    </div>
    <div class="table-responsive">
      <table class="table table-sm table-striped">
        <thead class="table-light"><tr><th>Date</th><th>Montant (DA)</th><th>Commentaire</th><th class="text-end">Actions</th></tr></thead>
        <tbody>
          {% for v in versements %}
          <tr>
            <td>{{ v.date_enregistrement }}</td>
            <td>{{ '%.2f'|format(v.montant) }}</td>
            <td>{{ v.commentaire or '' }}</td>
            <td class="text-end">
              <a href="{{ url_for('edit_versement', versement_id=v.id) }}" class="btn btn-sm btn-warning">âœï¸</a>
              <form method="POST" action="{{ url_for('delete_versement', versement_id=v.id) }}" class="d-inline"
                    onsubmit="return confirm('Supprimer ce versement ?')">
                <button class="btn btn-sm btn-danger">ğŸ—‘ï¸</button>
              </form>
            </td>
          </tr>
          {% else %}
          <tr><td colspan="4" class="text-muted">Aucun versement.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  <div class="col-md-6">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h5>DÃ©penses</h5>
      <a class="btn btn-sm btn-primary" href="{{ url_for('add_depense', avance_id=avance.id) }}">+ Ajouter</a>
    </div>
    <div class="table-responsive">
      <table class="table table-sm table-striped">
        <thead class="table-light"><tr><th>Date</th><th>Description</th><th>Montant (DA)</th><th>Justificatif</th><th class="text-end">Actions</th></tr></thead>
        <tbody>
          {% for d in depenses %}
          <tr>
            <td>{{ d.date_enregistrement }}</td>
            <td>{{ d.description }}</td>
            <td>{{ '%.2f'|format(d.montant) }}</td>
            <td>
              {% if d.justificatif %}
                <a href='{{ url_for("static", filename="uploads/" ~ d.justificatif) }}' target="_blank">Voir</a>
              {% else %}
                <span class="text-muted">Aucun</span>
              {% endif %}
            </td>
            <td class="text-end">
              <a href="{{ url_for('edit_depense', depense_id=d.id) }}" class="btn btn-sm btn-warning">âœï¸</a>
              <form method="POST" action="{{ url_for('delete_depense', depense_id=d.id) }}" class="d-inline"
                    onsubmit="return confirm('Supprimer cette dÃ©pense ?')">
                <button class="btn btn-sm btn-danger">ğŸ—‘ï¸</button>
              </form>
            </td>
          </tr>
          {% else %}
          <tr><td colspan="5" class="text-muted">Aucune dÃ©pense.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
<hr>
<div class="row text-center">
  <div class="col">
    <div class="text-muted">Total avancÃ©</div>
    <div class="fs-5">{{ '%.2f'|format(total_v) }} DA</div>
  </div>
  <div class="col">
    <div class="text-muted">Total dÃ©pensÃ©</div>
    <div class="fs-5">{{ '%.2f'|format(total_d) }} DA</div>
  </div>
  <div class="col">
    <div class="text-muted">Solde</div>
    <div class="fs-5">{{ '%.2f'|format(solde) }} DA</div>
  </div>
</div>
{% endblock %}
